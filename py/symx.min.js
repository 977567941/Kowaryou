// 本资源来源于互联网公开渠道，仅可用于个人学习爬虫技术。
// 严禁将其用于任何商业用途，下载后请于 24 小时内删除，搜索结果均来自源站，本人不承担任何责任。
import{Crypto as e}from"assets://js/lib/cat.js";const t={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36",Accept:"application/json, text/plain, */*","Accept-Language":"zh-CN,zh;q=0.9","Cache-Control":"no-cache",Pragma:"no-cache",Priority:"u=1, i","Sec-Ch-Ua":'"Not(A:Brand";v="8", "Chromium";v="144", "Google Chrome";v="144"',"Sec-Ch-Ua-Mobile":"?0","Sec-Ch-Ua-Platform":'"Windows"',"Sec-Fetch-Dest":"empty","Sec-Fetch-Mode":"cors","Sec-Fetch-Site":"same-origin","X-Platform":"web"};let r={reportId:"x-report-id",session:"",traceId:""},a="https://film.symx.club";function o(e){const t="0x1A2B3C4D5E6F7A8B9C";let r="";for(let a=0;a<e.length;a+=2){const o=parseInt(e.substr(a,2),16);r+=String.fromCharCode(o^t.charCodeAt(a/2%20))}return r}async function n(o,n={}){const i=o.startsWith("http")?o:`${a}${o}`,s=function(){const e=(new Date).getTime().toString().slice(0,-1),t=e.split("").reduce(((e,t)=>e+parseInt(t)),0);return e+t%10}(),c=function(t,o){const n={p:t.split("?")[0].replace(a,"").replace(/^\/api/,""),t:o,s:"symx_"+r.session};let i=r.traceId.split("").map((e=>n[e]||"")).join("");return i=i.replace(/1/g,"i").replace(/0/g,"o").replace(/5/g,"s"),e.HmacSHA256(i,r.session).toString()}(i,s),p={...t,[r.reportId]:c,"x-timestamp":s,referer:n.referer||`${a}/index`};try{const e=await req(i,{headers:p}),t=JSON.parse(e.content);return 200===t.code&&t.data?t.data:null}catch(e){return console.log(`Req Error [${o}]: ${e.message}`),null}}async function i(e){e.ext&&e.ext.startsWith("http")&&(a=e.ext.trim().replace(/\/$/,""));const t=await n("/api/system/config");t&&(r={reportId:o(t.reportId),session:o(t.session),traceId:o(t.traceId)},console.log("Security Initialized"))}async function s(e){const t=await n("/api/category/top");if(!t)return"{}";const r=[],o={},i=t.map((async e=>{const t=e.id.toString();r.push({type_id:t,type_name:e.name});try{const e=await n(`/api/film/category/filter?categoryId=${t}`,{referer:`${a}/category/${t}`});if(e){const r=[],a=(e,t,a)=>{a&&a.length&&r.push({key:e,name:t,init:"",value:[{n:"全部",v:""},...a.map((e=>({n:e,v:e})))]})};a("area","地区",e.areaOptions),a("year","年份",e.yearOptions),a("language","语言",e.languageOptions),e.sortOptions&&e.sortOptions.length&&r.push({key:"sort",name:"排序",init:e.sortOptions[0].value,value:e.sortOptions.map((e=>({n:e.label,v:e.value})))}),r.length&&(o[t]=r)}}catch(e){}}));return await Promise.all(i),JSON.stringify({class:r,filters:o})}async function c(){const e=await n("/api/film/category"),t=[];return e&&e.forEach((e=>{(e.filmList||[]).forEach((e=>{t.push({vod_id:e.id.toString(),vod_name:e.name,vod_pic:e.cover,vod_remarks:e.doubanScore||""})}))})),JSON.stringify({list:t})}async function p(e,t,r,o){const i=function(e){return Object.keys(e).map((t=>t+"="+encodeURIComponent(e[t]))).join("&")}({area:o.area||"",categoryId:e,language:o.language||"",pageNum:t,pageSize:"15",sort:o.sort||"updateTime",year:o.year||""}),s=await n(`/api/film/category/list?${i}`,{referer:`${a}/category/${e}`}),c=[];return s&&s.list&&s.list.forEach((e=>{c.push({vod_id:e.id.toString(),vod_name:e.name,vod_pic:e.cover,vod_remarks:e.updateStatus})})),JSON.stringify({list:c,page:parseInt(t)})}async function l(e,t,r=1){const o=await n(`/api/film/search?keyword=${encodeURIComponent(e)}&pageNum=${r}&pageSize=10`,{referer:`${a}/search?keyword=${encodeURIComponent(e)}`}),i=[];return o&&o.list&&o.list.forEach((e=>{i.push({vod_id:e.id.toString(),vod_name:e.name,vod_pic:e.cover,vod_remarks:e.updateStatus,vod_year:e.year,vod_area:e.area,vod_director:e.director})})),JSON.stringify({list:i,page:parseInt(r)})}async function d(e){const t=await n(`/api/film/detail?id=${e}`,{referer:`${a}/`});if(!t)return"{}";const r=[],o=[];(t.playLineList||[]).forEach((e=>{r.push(e.playerName);const t=e.lines.map((e=>`${e.name}$${e.id}`)).join("#");o.push(t)}));const i={vod_id:t.id.toString(),vod_name:t.name,vod_pic:t.cover,vod_year:t.year,vod_area:t.other,vod_actor:t.actor,vod_director:t.director,vod_content:t.blurb,vod_score:t.doubanScore,vod_play_from:r.join("$$$"),vod_play_url:o.join("$$$"),type_name:t.vod_class||""};return JSON.stringify({list:[i]})}async function u(e,r,o){const i=await n(`/api/line/play/parse?lineId=${r}`,{referer:`${a}/`});return JSON.stringify({jx:0,parse:0,url:i||"",header:{"User-Agent":t["User-Agent"]}})}export function __jsEvalReturn(){return{init:i,home:s,homeVod:c,category:p,search:l,detail:d,play:u}}